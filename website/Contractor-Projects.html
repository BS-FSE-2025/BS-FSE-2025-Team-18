<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Projects</title>
  <link rel="stylesheet" href="styles/contractor-projects.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<body>
  <header>
    <div class="logo">
      <img src="images/IMG_6583.png" alt="LOGO">
    </div>
    <nav>
      <a href="homepage-contractor.html">Home</a>
      <a href="Contractor-Projects.html" class="active">My Projects</a>
      <a href="aboutus.html">About Us</a>
      <a href="CheckList/CheckListContractor.html">CheckList</a>
    </nav>
  </header>

  <main>
    </section>
    <section id="projects">
      <div class="add-project">
        <h2>Add a New Project</h2>
        <form id="addProjectForm">
          <input type="text" id="projectName" placeholder="Project Name" required>
          <textarea id="projectDescription" placeholder="Project Description" required></textarea>
          <button type="submit">Add Project</button>
        </form>
      </div>
      <div id="project-list" class="project-grid">
        <!-- Projects will load dynamically here -->
      </div>
    </section>
  </main>

  <footer>
    <p>&copy; 2024 RenovaCalc. All rights reserved.</p>
  </footer>

    <script>
       const API_URL = "http://localhost:3000/api/projects";

// Fetch projects from the server
async function fetchProjects() {
    try {
        const response = await fetch(API_URL);
        if (!response.ok) throw new Error("Failed to fetch projects.");
        return await response.json();
    } catch (error) {
        console.error("Error fetching projects:", error);
        return [];
    }
}

// Display projects on the page
async function displayProjects() {
  const projects = await fetchProjects();
  const projectList = document.getElementById("project-list");
  projectList.innerHTML = "";

  projects.forEach(project => {
    const projectCard = document.createElement("div");
    projectCard.classList.add("project-card");
    projectCard.innerHTML = `
      <div class="project-card-content">
        <h3>${project.name}</h3>
        <p>${project.description}</p>
        <p>Status: <strong>${project.status}</strong></p>
      </div>
      <div class="project-actions">
        <button class="edit-project" onclick="editProject('${project._id}')">Edit</button>
        <button class="delete-project" onclick="deleteProject('${project._id}')">Delete</button>
        <button class="add-products" onclick="addProducts('${project._id}')">Add Products</button>
      </div>
    `;
    projectList.appendChild(projectCard);
  });
}


// Add a new project
document.getElementById("addProjectForm").addEventListener("submit", async function(event) {
    event.preventDefault();

    const projectName = document.getElementById("projectName").value;
    const projectDescription = document.getElementById("projectDescription").value;

    if (!projectName || !projectDescription) {
        alert("Please fill all fields.");
        return;
    }

    try {
        const response = await fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name: projectName, description: projectDescription }),
        });

        if (!response.ok) throw new Error("Failed to add project.");
        alert("Project added successfully!");
        await displayProjects();
        document.getElementById("addProjectForm").reset();
    } catch (error) {
        alert("Error adding project: " + error.message);
    }
});

// Delete a project
async function deleteProject(projectId) {
    if (!confirm("Are you sure you want to delete this project?")) return;

    try {
        const response = await fetch(`${API_URL}/${projectId}`, { method: "DELETE" });
        if (!response.ok) throw new Error("Failed to delete project.");
        alert("Project deleted successfully!");
        await displayProjects();
    } catch (error) {
        alert("Error deleting project: " + error.message);
    }
}

// Edit a project
async function editProject(projectId) {
    const newName = prompt("Enter the new project name:");
    const newDescription = prompt("Enter the new project description:");
    const newStatus = prompt("Enter the new status (Pending/In Progress/Completed):");

    if (!newName || !newDescription || !newStatus) {
        alert("Please fill all fields.");
        return;
    }

    try {
        const response = await fetch(`${API_URL}/${projectId}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name: newName, description: newDescription, status: newStatus }),
        });

        if (!response.ok) throw new Error("Failed to update project.");
        alert("Project updated successfully!");
        await displayProjects();
    } catch (error) {
        alert("Error updating project: " + error.message);
    }
}

// Add products to a project
async function addProducts(projectId) {
    const productName = prompt("Enter the product name:");
    const productQuantity = prompt("Enter the product quantity:");
    const productPrice = prompt("Enter the product price:");

    if (!productName || isNaN(productQuantity) || isNaN(productPrice)) {
        alert("Please enter valid product details.");
        return;
    }

    try {
        const response = await fetch(`${API_URL}/${projectId}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                $push: {
                    products: {
                        name: productName,
                        quantity: parseInt(productQuantity),
                        price: parseFloat(productPrice),
                    },
                },
            }),
        });

        if (!response.ok) throw new Error("Failed to add products.");
        alert("Products added successfully!");
        await displayProjects();
    } catch (error) {
        alert("Error adding products: " + error.message);
    }
}

// Load projects on page load
document.addEventListener("DOMContentLoaded", displayProjects);

    </script>
</body>
</html>
